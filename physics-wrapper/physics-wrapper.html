<!-- Import Polymer -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="physics-wrapper" attributes="loc vel mass acc">
    <template>
        <style>
            :host{
                position:absolute;
            };
        </style>
        <content></content>
    </template>

    <script>
        Polymer({
            created: function() {
                this.loc = {x: Math.random()*window.innerWidth * 0.8 + 100, y: Math.random()*300};
                this.vel = {x: 0, y: 0};
                this.acc = {x: 0, y: 0};
                this.mass = 1;
                this.friction = 0.008;
                this.isClicked = false;


                this.addEvents();
                
            },

            addEvents: function() {
                var polymer = this;
                $(this).on('mousedown', function(e) {
                    e.preventDefault();
                    window.mouseUp = false;
                    this.isClicked = true;


                    this.clickedWidth = $(e.target).width();
                    this.clickedHeight = $(e.target).height();
                    console.log(this.clickedWidth);
                });

                $(this).on('mouseup', function(e) {
                    this.isClicked = false;
                    this.acc.y = 18.8
                })


            },

            accelerate: function(x, y) {
                this.acc.x += x;
                this.acc.y += y + Math.random() * 18 - 8;
            },

            setBounds: function(xmin, xmax, ymin, ymax) {
            },

            // Estimates the new location based on 1 iteration of Euler's method
            advanceState: function(dt) {
                if (window.mouseUp) {
                    //restoration from mouseclick
                    this.isClicked = false;
                    this.acc.x = 0;
                    this.acc.y = 9.8;
                }
                if (this.isClicked) {
                    //simulated elasticity
                    this.acc.x = 100*(window.mouseX - this.clickedWidth/2 - this.loc.x) / (window.mouseX);
                    this.acc.y = 100*(window.mouseY - this.clickedHeight/2- this.loc.y) / window.mouseY;
                }
                if (this.isClicked || (this.loc.y + $(this).height() < window.innerHeight && this.loc.x > 0 && this.loc.x < window.innerWidth)) {
                    //main accelerating step
                    this.vel.x *= (1 - this.friction);
                    this.vel.y *= (1 - this.friction);

                    this.vel.x += dt * this.acc.x;
                    this.vel.y += dt * this.acc.y;

                    this.loc.x += dt * this.vel.x;
                    this.loc.y += dt * this.vel.y;
                } else {
                    //it has hit the edge and has no acceleration
                    this.acc = {x: 0, y: 0};
                    this.vel = {x: 0, y: 0};
                }
                this.updateState();
                
            },

            // Modifies the DOM to follow the attributes
            updateState: function () {
                $(this).css({top:this.loc.y, left:this.loc.x});

            }
        });
    </script>

</polymer-element>

